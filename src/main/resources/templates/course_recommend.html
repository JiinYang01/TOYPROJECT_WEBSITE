<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml">
<div layout:fragment="content" class="container my-3" style="margin-top: 800000px;">
    <div class="container my-4">
        <!-- 3개 추천 -->
        <!-- 검색 필드 -->
        <!-- 필터 버튼 -->
        <div class="my-3">
            <a th:href="@{/course/trend(sortType='priceAsc', categoryId=${selectedCategoryId})}"
               class="btn btn-light me-2" th:classappend="${sortType == 'priceAsc'} ? 'active' : ''">가격순</a>
            <a th:href="@{/course/trend(sortType='priceDesc', categoryId=${selectedCategoryId})}"
               class="btn btn-light me-2" th:classappend="${sortType == 'priceDesc'} ? 'active' : ''">가격 역순</a>
            <a th:href="@{/course/trend(sortType='popularity', categoryId=${selectedCategoryId})}"
               class="btn btn-light me-2" th:classappend="${sortType == 'popularity'} ? 'active' : ''">인기순</a>
        </div>

        <!-- 지역 선택 필터 -->
        <div class="my-3">
            <h5>지역 선택</h5>
            <form th:action="@{/user/recommend}" method="get" class="d-flex">
                <div class="btn-group" role="group">
                    <select id="sido" name="ctprvn" th:value="${ctprvn}">
                        <option value="">시도 선택</option>
                    </select>
                    <select id="sigugun" name="signgu" th:value="${signgu}">
                        <option value="">시군구 선택</option>
                    </select>
    <!--                <a th:href="@{/course/trend(categoryId=${selectedCategoryId}, sortType=${sortType}, ctprvn=${ctprvn}, signgu=${signgu})}"-->
    <!--                   th:text="검색"-->
    <!--                   class="btn">-->
    <!--                </a>-->
                </div>
                <button type="submit" class="btn btn-primary">검색</button>
            </form>
        </div>

        <!-- 카테고리 리스트 -->
        <div class="my-3">
            <h5>카테고리 선택</h5>
            <div class="btn-group" role="group">
                <a th:each="category : ${categoryList}"
                   th:href="@{/course/trend(categoryId=${category.categoryId}, sortType=${sortType})}"
                   th:text="${category.categoryName}"
                   th:classappend="${selectedCategoryId == category.categoryId} ? 'btn-primary' : 'btn-outline-secondary'"
                   class="btn">
                </a>
            </div>
        </div>

        <!-- 코스 목록 카드 -->
        <div class="row">
            <div class="col-md-4 mb-4" th:each="course : ${courseList}">
                <div class="card h-100 shadow-sm border-0">
<!--                    <img th:src="" class="card-img-top" alt="Course Image" style="height: 200px; object-fit: cover;">-->
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title" th:text="${course.courseNm}" style="font-weight: bold; color: #333;">Course Name</h5>
                        <p class="card-text text-muted" th:text="${course.category.categoryName}">Category</p>
                        <p class="card-text text-primary" th:text="'Price: ' + ${course.coursePrc} + '원'">Price</p>
                        <!-- Optional: 추가 정보 예시 -->
                        <a th:href="@{/course/detail/{courseId}(courseId=${course.courseId})}" class="btn btn-primary mt-auto" style="width: 100%;">자세히 보기</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-latest.min.js" type="application/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- External JavaScript (hangjungdong.js) -->
    <script type="application/javascript" src="https://zelkun.tistory.com/attachment/cfile8.uf@99BB7A3D5D45C065343307.js"></script>
    <script>
        $(document).ready(function() {
            console.log(hangjungdong);
            console.log("hi");

            const sidoSelect = $('#sido');
            const sigugunSelect = $('#sigugun');

            // 시도 목록 추가
            hangjungdong.sido.forEach(item => {
                sidoSelect.append(new Option(item.codeNm, item.sido));
            });

            // 시도 변경 시 시군구 목록 업데이트
            sidoSelect.change(function() {
                sigugunSelect.empty().append(new Option("시군구 선택", ""));

                const selectedSido = $(this).val();
                const sigugunList = hangjungdong.sigugun.filter(item => item.sido === selectedSido);

                sigugunList.forEach(item => {
                    sigugunSelect.append(new Option(item.codeNm, item.codeNm));
                });

                const tmp = $("select[name=ctprvn] option:selected").text();
                $("select[name=ctprvn] option:selected").attr('value', tmp);
                console.log($(this).val());
            });
        });
    </script>
</div>

</html>
